# Fixed Setup - Seafile Database Configuration

## Problem Solved ✅

The issue was that Seafile creates its own database user with a **UUID password** during initialization, and stores this password in its config files (`/shared/seafile/conf/ccnet.conf` and `seahub_settings.py`).

## How It Works Now

1. **MariaDB Container**:
   - Only sets `MARIADB_ROOT_PASSWORD` (for root access)
   - Creates the `seafile` database (from `MARIADB_DATABASE`)
   - Does NOT create the `seafile` user

2. **Seafile Container**:
   - Connects as **root** using `DB_ROOT_PASSWD`
   - Creates the `seafile` user with a **UUID password** (e.g., `f46d6fbe-3a7b-497b-9ae5-f6f1549c7afe`)
   - Stores this password in config files
   - Uses this user for all database operations

## Current Configuration

- **MariaDB Root Password**: `db_dev` (from `MARIADB_ROOT_PASSWORD`)
- **Seafile User Password**: `f46d6fbe-3a7b-497b-9ae5-f6f1549c7afe` (generated by Seafile, stored in config files)

## Important Notes

⚠️ **If you need to reset the database password**:
1. Check Seafile's config files for the actual password:
   ```bash
   kubectl exec -n seafile <pod-name> -- cat /shared/seafile/conf/ccnet.conf | grep PASSWD
   ```

2. Update the database password to match:
   ```bash
   kubectl exec mariadb-0 -n seafile -- mysql -u root -pdb_dev -e "ALTER USER 'seafile'@'%' IDENTIFIED BY '<password-from-config>'; FLUSH PRIVILEGES;"
   ```

⚠️ **For fresh installations**:
- The `MYSQL_USER_PASSWORD` environment variable is used by Seafile to create the user
- But Seafile may generate its own UUID password instead
- Always check the config files after initialization to get the actual password

